// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =========================================================
// üîê ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö NextAuth (Login System)
// =========================================================

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// =========================================================
// üë§ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á Login & Gamification)
// =========================================================

model User {
  id            String    @id @default(cuid())
  name          String? // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á (‡∏à‡∏≤‡∏Å Google)
  username      String?   @unique // ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Optional ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á
  email         String?   @unique
  emailVerified DateTime? // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•
  image         String? // ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏à‡∏≤‡∏Å Google)
  password      String? // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
  createdAt     DateTime  @default(now())

  // --- NextAuth Relations ---
  accounts Account[]
  sessions Session[]

  // --- Gamification Data ---
  rank       Int @default(1) // 1, 2, 3
  stars      Int @default(0) // ‡∏î‡∏≤‡∏ß‡∏™‡∏∞‡∏™‡∏°
  currentExp Int @default(0) // Exp ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  xp         Int @default(0) // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏£‡∏ß‡∏°

  // --- App Relations ---
  progress    LessonProgress[]
  testResults SpeedTestResult[]

  @@index([email])
}

// =========================================================
// üìö ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
// =========================================================

// 2. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ä‡πà‡∏ô "‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1: ‡πÅ‡∏õ‡πâ‡∏ô‡πÄ‡∏´‡∏¢‡πâ‡∏≤")
model Lesson {
  id    Int    @id @default(autoincrement())
  title String // ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
  level String // 'beginner', 'intermediate', 'advanced'
  order Int // ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á (1, 2, 3...)

  subLessons SubLesson[]
}

// 3. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏î‡πà‡∏≤‡∏ô‡∏¢‡πà‡∏≠‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô "b1a", "b1b")
model SubLesson {
  id      String @id // ‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô "b1a"
  title   String // ‡∏ä‡∏∑‡πà‡∏≠‡∏î‡πà‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏≠‡∏≤
  content String // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå (Text)
  mode    String @default("word")
  order     Int

  lessonId Int
  lesson   Lesson @relation(fields: [lessonId], references: [id])

  userProgress LessonProgress[]
}

// 4. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô (‡πÉ‡∏Ñ‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏î‡πà‡∏≤‡∏ô‡πÑ‡∏´‡∏ô ‡πÑ‡∏î‡πâ‡∏Å‡∏µ‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
model LessonProgress {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  subLessonId String
  subLesson   SubLesson @relation(fields: [subLessonId], references: [id])

  wpm      Int    @default(0)
  accuracy Float  @default(0)
  stars    Int    @default(0) // ‡∏î‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ (1-3)
  duration Int    @default(0)
  status   String @default("completed") // completed

  updatedAt DateTime @updatedAt

  @@unique([userId, subLessonId]) // ‡∏´‡πâ‡∏≤‡∏° User ‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥ (‡πÉ‡∏´‡πâ update ‡πÅ‡∏ó‡∏ô)
  @@index([userId])
}

model SpeedTestResult {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  duration Int // ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (1, 3, ‡∏´‡∏£‡∏∑‡∏≠ 5 ‡∏ô‡∏≤‡∏ó‡∏µ)
  wpm      Int // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
  accuracy Int // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
  mistakes Json // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î (‡πÄ‡∏ä‡πà‡∏ô {"‡∏Å": 5, "‡∏Ç": 2}) ‡πÑ‡∏ß‡πâ‡∏ó‡∏≥‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á

  createdAt DateTime @default(now())
}
